<project name="svnwiki" default="war" basedir=".">

  <property name="source" value="src" />   
  <property name="web" value="WebContent" />   
  <property name="build" value="ant-classes-build" />   
  <property name="war" value="${ant.project.name}.war" />   
  <property name="prepopulated-pages" value="net/hillsdon/svnwiki/web/vcintegration/prepopulated/**"/>

  <path id="classpath">
     <fileset dir="lib">
        <include name="*.jar" />
     </fileset>
     <fileset dir="${web}/WEB-INF/lib">
        <include name="*.jar" />
     </fileset>
  </path>    

  <target name="init">
     <mkdir dir="${build}" />
  </target>

  <target name="clean">
    <delete dir="${build}" />
    <delete file="${war}"/>
  </target>

  <target name="compile" depends="init">
    <javac srcdir="${source}"
           destdir="${build}">
      <classpath refid="classpath" />
    </javac>
    <copy todir="${build}">
      <fileset dir="${source}">
        <include name="${preopulated-pages}"/>
        <include name="net/hillsdon/svnwiki/web/taglib/svnwiki.tld"/>
      </fileset>
    </copy>
  </target>

  <target name="taglibJar" depends="compile">
    <mkdir dir="${build}/META-INF"/>
    <move file="${build}/net/hillsdon/svnwiki/web/taglib/svnwiki.tld" tofile="${build}/META-INF/svnwiki.tld"/>
    <jar destfile="WebContent/WEB-INF/lib/svnwiki-tlds.jar" >
      <fileset dir="${build}">
        <include name="net/hillsdon/svnwiki/web/taglib/**/*.class"/>
      </fileset>
      <metainf dir="${build}/META-INF">
        <include name="**/*"/>
      </metainf>
    </jar>
  </target>

  <target name="war" depends="compile, taglibJar">
    <war warfile="${war}"
         webxml="${web}/WEB-INF/web.xml">
       <classes dir="${build}">
         <include name="**/*.class"/>
         <include name="${prepopulated-pages}"/>
       </classes>
       <fileset dir="${web}" includes="*" />
       <webinf dir="${web}/WEB-INF" includes="**" />
    </war>
  </target>

</project>

